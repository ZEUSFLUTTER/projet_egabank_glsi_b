<div class="page-container">
  <div class="form-card">
    <div class="form-header">
      <a routerLink="/dashboard/clients" class="back-link">
        <i class="fas fa-arrow-left"></i>
      </a>
      <div class="header-text">
        <h1>
          <i class="fas" [class.fa-user-plus]="!isEditMode" [class.fa-user-edit]="isEditMode"></i>
          {{ isEditMode ? 'Modifier le Client' : 'Nouveau Client' }}
        </h1>
        <p>{{ isEditMode ? 'Modifiez les informations du client' : 'Remplissez les informations pour créer un nouveau client' }}</p>
      </div>
    </div>

    @if (submitError) {
      <div class="error-banner">
        <i class="fas fa-exclamation-circle"></i>
        {{ submitError }}
      </div>
    }

    <form [formGroup]="clientForm" (ngSubmit)="onSubmit()" class="client-form">
      <div class="form-section">
        <h3><i class="fas fa-id-card"></i> Identité</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label for="nom">Nom *</label>
            <input 
              type="text" 
              id="nom" 
              formControlName="nom"
              [class.invalid]="isFieldInvalid('nom')"
              placeholder="Entrez le nom"
            >
            @if (isFieldInvalid('nom')) {
              <span class="error-message">{{ getFieldError('nom') }}</span>
            }
          </div>

          <div class="form-group">
            <label for="prenom">Prénom *</label>
            <input 
              type="text" 
              id="prenom" 
              formControlName="prenom"
              [class.invalid]="isFieldInvalid('prenom')"
              placeholder="Entrez le prénom"
            >
            @if (isFieldInvalid('prenom')) {
              <span class="error-message">{{ getFieldError('prenom') }}</span>
            }
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="dnaissance">Date de Naissance *</label>
            <input 
              type="date" 
              id="dnaissance" 
              formControlName="dnaissance"
              [class.invalid]="isFieldInvalid('dnaissance')"
            >
            @if (isFieldInvalid('dnaissance')) {
              <span class="error-message">{{ getFieldError('dnaissance') }}</span>
            }
          </div>

          <div class="form-group">
            <label>Sexe *</label>
            <div class="radio-group">
              <div class="radio-option" (click)="clientForm.get('sexe')?.setValue('M')">
                <input type="radio" formControlName="sexe" value="M" aria-label="Masculin">
                <span class="radio-custom"></span>
                <i class="fas fa-mars"></i> <span>Masculin</span>
              </div>
              <div class="radio-option" (click)="clientForm.get('sexe')?.setValue('F')">
                <input type="radio" formControlName="sexe" value="F" aria-label="Féminin">
                <span class="radio-custom"></span>
                <i class="fas fa-venus"></i> <span>Féminin</span>
              </div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="nationalite">Nationalité *</label>
          <select 
            id="nationalite" 
            formControlName="nationalite"
            [class.invalid]="isFieldInvalid('nationalite')"
          >
            <option value="">Sélectionnez une nationalité</option>
            @for (nat of nationalities; track nat) {
              <option [value]="nat">{{ nat }}</option>
            }
          </select>
          @if (isFieldInvalid('nationalite')) {
            <span class="error-message">{{ getFieldError('nationalite') }}</span>
          }
        </div>
      </div>

      <div class="form-section">
        <h3><i class="fas fa-address-book"></i> Coordonnées</h3>
        
        <div class="form-group">
          <label for="adresse">Adresse *</label>
          <textarea 
            id="adresse" 
            formControlName="adresse"
            [class.invalid]="isFieldInvalid('adresse')"
            placeholder="Entrez l'adresse complète"
            rows="3"
          ></textarea>
          @if (isFieldInvalid('adresse')) {
            <span class="error-message">{{ getFieldError('adresse') }}</span>
          }
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="tel">Téléphone *</label>
            <input 
              type="tel" 
              id="tel" 
              formControlName="tel"
              [class.invalid]="isFieldInvalid('tel')"
              placeholder="911209..."
            >
            @if (isFieldInvalid('tel')) {
              <span class="error-message">{{ getFieldError('tel') }}</span>
            }
          </div>

          <div class="form-group">
            <label for="courriel">Email *</label>
            <input 
              type="email" 
              id="courriel" 
              formControlName="courriel"
              [class.invalid]="isFieldInvalid('courriel')"
              placeholder="exemple@email.com"
            >
            @if (isFieldInvalid('courriel')) {
              <span class="error-message">{{ getFieldError('courriel') }}</span>
            }
          </div>
        </div>
      </div>

      <div class="form-actions">
        <a routerLink="/dashboard/clients" class="btn btn-secondary">
          Annuler
        </a>
        <button type="submit" class="btn btn-primary" [disabled]="loading">
          @if (loading) {
            <i class="fas fa-spinner fa-spin"></i>
            Traitement...
          } @else {
            {{ isEditMode ? 'Enregistrer' : 'Créer le client' }}
          }
        </button>
      </div>
    </form>
  </div>
</div>
