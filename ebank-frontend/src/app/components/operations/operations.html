<div class="container-fluid animate__animated animate__fadeIn">
  <!-- HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-5">
    <div>
      <h2 class="fw-bold text-dark tracking-tight">Journal des Transactions</h2>
      <p class="text-muted small">Pilotez vos flux financiers en temps réel.</p>
    </div>
    <button class="btn btn-primary rounded-4 px-4 py-2 fw-bold shadow-sm" (click)="showForm = !showForm">
      <i class="bi" [ngClass]="showForm ? 'bi-dash-lg' : 'bi-plus-lg'"></i> 
      {{ showForm ? 'Annuler' : 'Nouvelle Opération' }}
    </button>
  </div>

  <!-- FORMULAIRE  -->
  <div class="card border-0 shadow rounded-4 p-4 mb-4 bg-primary text-white" *ngIf="showForm">
    <h5 class="fw-bold mb-4"><i class="bi bi-lightning-fill me-2"></i>Exécuter une opération</h5>
    <form [formGroup]="opForm" (ngSubmit)="handleOperation()">
        <div class="row g-3">
            <div class="col-md-2">
                <label class="label-premium text-white">TYPE</label>
                <select formControlName="type" class="form-select border-0 rounded-3">
                    <option value="VIREMENT">Virement</option>
                    <option value="VERSEMENT">Versement</option>
                    <option value="RETRAIT">Retrait</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="label-premium text-white">SOURCE</label>
                <select formControlName="numCompte" class="form-select border-0 rounded-3">
                    <option value="">Choisir compte source</option>
                    <option *ngFor="let acc of accounts" [value]="acc.numCompte">{{acc.client.nom}} - {{acc.numCompte.substring(0,10)}}...</option>
                </select>
            </div>
            <div class="col-md-3" *ngIf="opForm.value.type === 'VIREMENT'">
                <label class="label-premium text-white">DESTINATAIRE</label>
                <!--  -->
                <select formControlName="numCompteDest" class="form-select border-0 rounded-3">
                    <option value="">Choisir bénéficiaire</option>
                    <option *ngFor="let acc of accounts" [value]="acc.numCompte">{{acc.client.nom}} - {{acc.numCompte.substring(0,10)}}...</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="label-premium text-white">MONTANT (CFA)</label>
                <input type="number" formControlName="montant" class="form-control border-0 rounded-3">
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button [disabled]="opForm.invalid || loading" class="btn btn-light w-100 fw-bold rounded-3">OK</button>
            </div>
        </div>
        <div class="mt-3">
          <label class="label-premium text-white">LIBELLÉ / MOTIF</label>
          <input type="text" formControlName="description" class="form-control border-0 rounded-3" placeholder="Ex: Cadeau anniversaire">
        </div>
    </form>
  </div>

  <!-- FILTRES -->
  <div class="card border-0 shadow-sm rounded-4 p-4 mb-4 bg-white">
    <div class="row g-3 align-items-end">
      <div class="col-md-4">
        <label class="label-premium">COMPTE</label>
        <select [(ngModel)]="searchIban" class="form-select select-premium">
          <option value="">Sélectionner un compte</option>
          <option *ngFor="let acc of accounts" [value]="acc.numCompte">{{acc.client.nom}} ({{acc.numCompte.substring(0,12)}}...)</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="label-premium">DU</label>
        <input type="date" [(ngModel)]="dateStart" class="form-control input-premium">
      </div>
      <div class="col-md-3">
        <label class="label-premium">AU</label>
        <input type="date" [(ngModel)]="dateEnd" class="form-control input-premium">
      </div>
      <div class="col-md-2">
        <button class="btn btn-dark w-100 rounded-pill fw-bold py-2" (click)="loadHistory()">Filtrer</button>
      </div>
    </div>
  </div>

  <!-- TABLEAU -->
  <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead>
          <tr class="table-header-premium">
            <th class="ps-4">DATE</th>
            <th>LIBELLÉ</th>
            <th class="text-end">MONTANT</th>
            <th class="pe-4 text-end">SOLDE APRÈS</th>
          </tr>
        </thead>
         <tbody>
          <tr *ngFor="let t of transactions" class="transaction-row">
  <td class="ps-4">
    <div class="small fw-medium">{{t.dateOperation | date:'dd/MM/yy'}}</div>
    <div class="extra-small text-muted">{{t.dateOperation | date:'HH:mm'}}</div>
  </td>
  <td>
    <div class="d-flex align-items-center">
      <div class="icon-circle me-3" [ngClass]="t.typeOperation === 'CREDIT' ? 'bg-success-subtle' : 'bg-danger-subtle'">
         <i [class]="t.typeOperation === 'CREDIT' ? 'bi bi-arrow-down-left text-success' : 'bi bi-arrow-up-right text-danger'"></i>
      </div>
      <span class="fw-semibold small">{{t.description}}</span>
    </div>
  </td>
  <td class="text-end fw-bold" [ngClass]="t.typeOperation === 'CREDIT' ? 'text-success' : 'text-danger'">
    {{t.typeOperation === 'CREDIT' ? '+' : '-'}} {{t.montant | number}} CFA
  </td>
  <!-- -->
  <td class="pe-4 text-end fw-bold text-dark small">
      {{ t.soldeApres | number:'1.0-0' }} CFA
  </td>
</tr>
        </tbody>
      </table>
    </div>
  </div>
</div>