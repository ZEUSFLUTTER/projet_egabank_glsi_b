{
	"info": {
		"_postman_id": "bank-api-tests",
		"name": "Bank API - Tests Complets",
		"description": "Collection complète pour tester toutes les APIs du système bancaire",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{auth_token}}",
				"type": "string"
			}
		]
	},
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8080/api",
			"type": "string"
		},
		{
			"key": "auth_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "client_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "compte_numero",
			"value": "",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "1. Authentification",
			"item": [
				{
					"name": "Login Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    pm.collectionVariables.set('auth_token', response.token);",
									"    pm.test('Login successful', function () {",
									"        pm.expect(response.token).to.not.be.empty;",
									"    });",
									"} else {",
									"    pm.test('Login failed', function () {",
									"        pm.expect.fail('Login should succeed');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"admin\",\n    \"password\": \"password\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": ["{{base_url}}"],
							"path": ["auth", "login"]
						}
					}
				},
				{
					"name": "Register New User",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"testuser\",\n    \"password\": \"testpass\",\n    \"email\": \"test@example.com\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/register",
							"host": ["{{base_url}}"],
							"path": ["auth", "register"]
						}
					}
				}
			]
		},
		{
			"name": "2. Gestion Clients (CRUD)",
			"item": [
				{
					"name": "Créer un Client",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    pm.collectionVariables.set('client_id', response.id);",
									"    pm.test('Client créé avec succès', function () {",
									"        pm.expect(response.id).to.not.be.empty;",
									"        pm.expect(response.nom).to.eql('Diop');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"nom\": \"Diop\",\n    \"prenom\": \"Amadou\",\n    \"dateNaissance\": \"1990-05-15\",\n    \"sexe\": \"M\",\n    \"adresse\": \"123 Rue de la Paix, Dakar\",\n    \"numeroTelephone\": \"+221 77 123 45 67\",\n    \"courriel\": \"amadou.diop@email.com\",\n    \"nationalite\": \"Sénégalaise\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/clients",
							"host": ["{{base_url}}"],
							"path": ["clients"]
						}
					}
				},
				{
					"name": "Lister tous les Clients",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/clients",
							"host": ["{{base_url}}"],
							"path": ["clients"]
						}
					}
				},
				{
					"name": "Obtenir un Client par ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/clients/{{client_id}}",
							"host": ["{{base_url}}"],
							"path": ["clients", "{{client_id}}"]
						}
					}
				},
				{
					"name": "Modifier un Client",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"nom\": \"Diop\",\n    \"prenom\": \"Amadou\",\n    \"dateNaissance\": \"1990-05-15\",\n    \"sexe\": \"M\",\n    \"adresse\": \"456 Avenue Bourguiba, Dakar\",\n    \"numeroTelephone\": \"+221 77 123 45 67\",\n    \"courriel\": \"amadou.diop@email.com\",\n    \"nationalite\": \"Sénégalaise\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/clients/{{client_id}}",
							"host": ["{{base_url}}"],
							"path": ["clients", "{{client_id}}"]
						}
					}
				},
				{
					"name": "Rechercher des Clients",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/clients/search?term=Diop",
							"host": ["{{base_url}}"],
							"path": ["clients", "search"],
							"query": [
								{
									"key": "term",
									"value": "Diop"
								}
							]
						}
					}
				}
			]
		},
		{
			"name": "3. Gestion Comptes (CRUD)",
			"item": [
				{
					"name": "Créer un Compte",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    pm.collectionVariables.set('compte_numero', response.numeroCompte);",
									"    pm.test('Compte créé avec succès', function () {",
									"        pm.expect(response.numeroCompte).to.not.be.empty;",
									"        pm.expect(response.typeCompte).to.eql('COURANT');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"proprietaireId\": {{client_id}},\n    \"typeCompte\": \"COURANT\",\n    \"solde\": 100000\n}"
						},
						"url": {
							"raw": "{{base_url}}/comptes",
							"host": ["{{base_url}}"],
							"path": ["comptes"]
						}
					}
				},
				{
					"name": "Lister tous les Comptes",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/comptes",
							"host": ["{{base_url}}"],
							"path": ["comptes"]
						}
					}
				},
				{
					"name": "Obtenir Comptes par Client",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/comptes/client/{{client_id}}",
							"host": ["{{base_url}}"],
							"path": ["comptes", "client", "{{client_id}}"]
						}
					}
				},
				{
					"name": "Obtenir Compte par Numéro",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/comptes/numero/{{compte_numero}}",
							"host": ["{{base_url}}"],
							"path": ["comptes", "numero", "{{compte_numero}}"]
						}
					}
				}
			]
		},
		{
			"name": "4. Opérations Bancaires",
			"item": [
				{
					"name": "Effectuer un Dépôt",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Dépôt effectué avec succès', function () {",
									"    pm.response.to.have.status(201);",
									"    const response = pm.response.json();",
									"    pm.expect(response.typeTransaction).to.eql('DEPOT');",
									"    pm.expect(response.montant).to.eql(50000);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"numeroCompte\": \"{{compte_numero}}\",\n    \"montant\": 50000,\n    \"description\": \"Dépôt de test via Postman\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/transactions/depot",
							"host": ["{{base_url}}"],
							"path": ["transactions", "depot"]
						}
					}
				},
				{
					"name": "Effectuer un Retrait",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Retrait effectué avec succès', function () {",
									"    pm.response.to.have.status(201);",
									"    const response = pm.response.json();",
									"    pm.expect(response.typeTransaction).to.eql('RETRAIT');",
									"    pm.expect(response.montant).to.eql(25000);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"numeroCompte\": \"{{compte_numero}}\",\n    \"montant\": 25000,\n    \"description\": \"Retrait de test via Postman\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/transactions/retrait",
							"host": ["{{base_url}}"],
							"path": ["transactions", "retrait"]
						}
					}
				},
				{
					"name": "Effectuer un Virement",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Virement effectué avec succès', function () {",
									"    pm.response.to.have.status(201);",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.be.an('array');",
									"    pm.expect(response.length).to.eql(2);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"compteSource\": \"{{compte_numero}}\",\n    \"compteDestinataire\": \"SN12K00100152000025000000269\",\n    \"montant\": 10000,\n    \"description\": \"Virement de test via Postman\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/transactions/virement",
							"host": ["{{base_url}}"],
							"path": ["transactions", "virement"]
						}
					}
				}
			]
		},
		{
			"name": "5. Consultation Transactions",
			"item": [
				{
					"name": "Lister Transactions d'un Compte",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/transactions/compte/{{compte_numero}}",
							"host": ["{{base_url}}"],
							"path": ["transactions", "compte", "{{compte_numero}}"]
						}
					}
				},
				{
					"name": "Transactions par Période",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/transactions/compte/{{compte_numero}}/periode?dateDebut=2024-01-01T00:00:00&dateFin=2024-12-31T23:59:59",
							"host": ["{{base_url}}"],
							"path": ["transactions", "compte", "{{compte_numero}}", "periode"],
							"query": [
								{
									"key": "dateDebut",
									"value": "2024-01-01T00:00:00"
								},
								{
									"key": "dateFin",
									"value": "2024-12-31T23:59:59"
								}
							]
						}
					}
				}
			]
		},
		{
			"name": "6. Génération de Relevés",
			"item": [
				{
					"name": "Générer Relevé (Téléchargement)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/releves/compte/{{compte_numero}}?dateDebut=2024-01-01T00:00:00&dateFin=2024-12-31T23:59:59",
							"host": ["{{base_url}}"],
							"path": ["releves", "compte", "{{compte_numero}}"],
							"query": [
								{
									"key": "dateDebut",
									"value": "2024-01-01T00:00:00"
								},
								{
									"key": "dateFin",
									"value": "2024-12-31T23:59:59"
								}
							]
						}
					}
				},
				{
					"name": "Voir Relevé (Visualisation)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/releves/compte/{{compte_numero}}/view?dateDebut=2024-01-01T00:00:00&dateFin=2024-12-31T23:59:59",
							"host": ["{{base_url}}"],
							"path": ["releves", "compte", "{{compte_numero}}", "view"],
							"query": [
								{
									"key": "dateDebut",
									"value": "2024-01-01T00:00:00"
								},
								{
									"key": "dateFin",
									"value": "2024-12-31T23:59:59"
								}
							]
						}
					}
				}
			]
		},
		{
			"name": "7. Tests de Validation",
			"item": [
				{
					"name": "Test Validation - Client Invalide",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Validation échoue correctement', function () {",
									"    pm.response.to.have.status(400);",
									"    const response = pm.response.json();",
									"    pm.expect(response.errors).to.not.be.empty;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"nom\": \"\",\n    \"prenom\": \"\",\n    \"courriel\": \"email-invalide\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/clients",
							"host": ["{{base_url}}"],
							"path": ["clients"]
						}
					}
				},
				{
					"name": "Test Solde Insuffisant",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Solde insuffisant détecté', function () {",
									"    pm.response.to.have.status(400);",
									"    const response = pm.response.json();",
									"    pm.expect(response.message).to.include('insuffisant');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"numeroCompte\": \"{{compte_numero}}\",\n    \"montant\": 999999999,\n    \"description\": \"Retrait impossible\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/transactions/retrait",
							"host": ["{{base_url}}"],
							"path": ["transactions", "retrait"]
						}
					}
				}
			]
		}
	]
}